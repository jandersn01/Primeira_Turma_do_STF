<!DOCTYPE html>
<html lang="pt-br"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Meus Processos</title>
</head>
<body>

    <div layout:fragment="conteudo">
        <div class="card mt-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Meus Processos</h4>
            </div>
            
            <div class="card-body">
                
                <!-- Mensagem quando não há aluno cadastrado -->
                <div th:if="${aluno == null}" class="alert alert-warning">
                    <h5 class="alert-heading">
                        <i class="bi bi-exclamation-triangle"></i> Nenhum aluno cadastrado
                    </h5>
                    <p th:text="${mensagem}">Nenhum aluno cadastrado no sistema. Por favor, cadastre um aluno primeiro para visualizar seus processos.</p>
                    <hr>
                    <p class="mb-0">
                        <a th:href="@{/admin/aluno/form}" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Cadastrar Aluno
                        </a>
                    </p>
                </div>
                
                <!-- Informações do Aluno -->
                <div th:if="${aluno != null}" class="mb-3">
                    <p class="text-muted">
                        <strong>Aluno:</strong> 
                        <span th:text="${aluno.nome}">Nome do Aluno</span>
                        <span class="ms-2">(<span th:text="${aluno.matricula}">Matrícula</span>)</span>
                    </p>
                </div>

                <!-- Formulário de Filtros (só mostra se houver aluno) -->
                <div th:if="${aluno != null}" class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Filtros</h5>
                    </div>
                    <div class="card-body">
                        <form method="get" th:action="@{/aluno/processo/list}">
                            <div class="row g-3">
                                <!-- Filtro por Status -->
                                <div class="col-md-4">
                                    <label for="status" class="form-label">Status</label>
                                    <select class="form-select" id="status" name="status">
                                        <option value="">Todos os status</option>
                                        <option th:each="s : ${statusList}" 
                                                th:value="${s.name()}" 
                                                th:text="${s.descricao}"
                                                th:selected="${statusSelecionado == s.name()}">
                                            Status
                                        </option>
                                    </select>
                                </div>
                                
                                <!-- Filtro por Assunto -->
                                <div class="col-md-4">
                                    <label for="assuntoId" class="form-label">Assunto</label>
                                    <select class="form-select" id="assuntoId" name="assuntoId">
                                        <option value="">Todos os assuntos</option>
                                        <option th:each="a : ${assuntos}" 
                                                th:value="${a.id}" 
                                                th:text="${a.nome}"
                                                th:selected="${assuntoSelecionado == a.id}">
                                            Assunto
                                        </option>
                                    </select>
                                </div>
                                
                                <!-- Ordenação -->
                                <div class="col-md-4">
                                    <label for="ordenacao" class="form-label">Ordenar por Data</label>
                                    <select class="form-select" id="ordenacao" name="ordenacao">
                                        <option value="desc" th:selected="${ordenacaoSelecionada == 'desc'}">
                                            Mais recentes primeiro
                                        </option>
                                        <option value="asc" th:selected="${ordenacaoSelecionada == 'asc'}">
                                            Mais antigos primeiro
                                        </option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-funnel"></i> Filtrar
                                    </button>
                                    <a th:href="@{/aluno/processo/list}" class="btn btn-secondary ms-2">
                                        <i class="bi bi-x-circle"></i> Limpar Filtros
                                    </a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Mensagem quando não há processos (mas há aluno) -->
                <div th:if="${aluno != null && #lists.isEmpty(processos)}" class="alert alert-info">
                    <i class="bi bi-info-circle"></i>
                    Nenhum processo encontrado com os filtros selecionados.
                </div>

                <!-- Tabela de Processos (só mostra se houver aluno e processos) -->
                <div th:if="${aluno != null && !#lists.isEmpty(processos)}">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>Número</th>
                                    <th>Assunto</th>
                                    <th>Status</th>
                                    <th>Data de Recepção</th>
                                    <th>Relator</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="processo : ${processos}">
                                    <td>
                                        <strong th:text="${processo.numero}">123/2024</strong>
                                    </td>
                                    <td th:text="${processo.assunto.nome}">Assunto do Processo</td>
                                    <td>
                                        <span class="badge bg-secondary" 
                                              th:if="${processo.status.name() == 'CRIADO'}"
                                              th:text="${processo.status.descricao}">Criado</span>
                                        <span class="badge bg-info" 
                                              th:if="${processo.status.name() == 'DISTRIBUIDO'}"
                                              th:text="${processo.status.descricao}">Distribuído</span>
                                        <span class="badge bg-warning" 
                                              th:if="${processo.status.name() == 'EM_PAUTA'}"
                                              th:text="${processo.status.descricao}">Em Pauta</span>
                                        <span class="badge bg-primary" 
                                              th:if="${processo.status.name() == 'EM_JULGAMENTO'}"
                                              th:text="${processo.status.descricao}">Em Julgamento</span>
                                        <span class="badge bg-success" 
                                              th:if="${processo.status.name() == 'JULGADO'}"
                                              th:text="${processo.status.descricao}">Julgado</span>
                                    </td>
                                    <td th:text="${#temporals.format(processo.dataRecepcao, 'dd/MM/yyyy')}">01/01/2024</td>
                                    <td>
                                        <span th:if="${processo.relator != null}" 
                                              th:text="${processo.relator.nome}">Nome do Relator</span>
                                        <span th:if="${processo.relator == null}" 
                                              class="text-muted fst-italic">Aguardando designação</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Informação sobre quantidade de processos -->
                    <div class="mt-3">
                        <p class="text-muted">
                            <strong>Total de processos:</strong> 
                            <span th:text="${#lists.size(processos)}">0</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>

